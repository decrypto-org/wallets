\section{Transparent Account-based Wallets}

For simplicity and without loss of generality we assume an Ethereum-like cryptocurrency.

Because in the account model there is no need for change outputs, new addresses are not automatically derived by wallets. New addresses are derived and used only by the explicit request of the user. Traditionally account-based wallets only hold a single address and public key, and we will assume the same in this section for simplification.

A transaction description is comprised of the address of the recipient, an amount of cryptocurrency and a fee. In Ethereum this fee takes the form of a gas price.
%TODO cite
To fund a transaction description the wallet performs the following steps:

\begin{enumerate}
    \item Fill in a valid address corresponding to a public key that:
    \begin{enumerate}
        \item holds at least as much cryptocurrency in its balance than what will be spent in the transaction and
        \item is derivable from the seed.
    \end{enumerate}
    \item Fill in the valid nonce in order to make this transaction spendable.
    \item Sign the transaction with the appropriate secret key.
\end{enumerate}

The transaction can subsequently be broadcast and accepted by the network.

We remark that an account-based wallet may offer limited functionality. For example, having access to the state it is easy to know the nonce and balance of any address of interest, thus funding a transaction description is straightforward. State however does not allow us to obtain the transaction history.

\subsection{Full Node}
A full node has access to the complete state and the full chain (i.e. all blocks and all their transactions), after a sync. For each derivable address, its balance and nonce can be looked up directly from the state. To obtain the transaction history for a set of addresses, every tranaction from the genesis block up to the tip must be checked.

\subsection{Metamask}
Metamask connects to a trusted web3 server and communicates with it over JSON-RPC in order to
\begin{enumerate}
    \item query the address' balance (via \texttt{getBalance})
    \item obtain the address' nonce (via \texttt{getTransactionCount})
\end{enumerate}

An explorer is used in order to obtain the transaction history, namely Etherscan.
